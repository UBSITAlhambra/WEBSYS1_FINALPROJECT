<?php
include "oop.php"; 
$oop = new oop_class();

// Get and sanitize search term
$searchTerm = $_GET['search_term'] ?? '';
$safeSearchTerm = htmlspecialchars($searchTerm);

// Execute the multi-table search 
$results = $oop->search_transactions_by_name($safeSearchTerm);
?>
<style>
.search-result-table tr:hover { background-color: #e9e9e9; cursor: pointer; }
.search-result-table td { border: none; padding: 6px 8px; font-size: 12px; }
</style>

<div style="max-height: 300px; overflow-y: auto; position:relative; z-index:999;">
    <table class="search-result-table" style="width: 100%; border-collapse: collapse;">
    
        <?php if (empty($results)): ?>
            <tr>
                <td colspan="4" style="text-align: center; padding: 15px;">
                    <h5 style="color:#6c757d; font-size:1rem; margin:0;">No Records Found for "<?= $safeSearchTerm ?>"</h5>
                </td>
            </tr>
        <?php else: ?>
            <tr style="background-color: #f2f2f2;">
                <td style="font-weight: bold;">Medicine</td>
                <td style="font-weight: bold;">Student</td>
                <td style="font-weight: bold;">Qty</td>
                <td style="font-weight: bold;">Date</td>
            </tr>
            
            <?php foreach ($results as $row): ?>
                <!-- Clicking a row triggers the full page search using the Medicine Name -->
                <tr onclick="getData('<?= htmlspecialchars($row['medicineName'], ENT_QUOTES) ?>')">
                    <td><?= htmlspecialchars($row['medicineName']) ?></td>
                    <td><?= htmlspecialchars($row['studentName']) ?></td>
                    <td><?= htmlspecialchars($row['quantity']) ?></td>
                    <td><?= htmlspecialchars($row['transactionDate']) ?></td>
                </tr>
            <?php endforeach; ?>
        <?php endif; ?>
    </table>
</div>